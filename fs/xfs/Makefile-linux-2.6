#!smake
#
# Makefile for SGI XFS File System
#
# $Revision: 1.43 $
DEPTH?=../..
include ${DEPTH}/kcommondefs
KPATH=$(TOP)/fs/xfs
.PATH:$(KPATH)

#if defined(DBOPTS) && !empty(DBOPTS)
#else
#
# when compiling a nondebug kernel, turn off compiler warnings about variables 
# being set but not used. with DEBUG disabled, the ASSERT statements are gone.
#
KWOFF=,1552
#endif

LCDEFS+= -D_NOPROJQUOTAS
KCOPTS=-fullwarn $(XFSCOPTS)
XFS_NAME=xfs.a
XFS_CSRCS=	xfs_alloc.c \
		xfs_alloc_btree.c \
		xfs_attr.c \
		xfs_attr_leaf.c \
		xfs_bit.c \
		xfs_bmap.c \
		xfs_bmap_btree.c \
		xfs_btree.c \
		xfs_buf_item.c \
		xfs_da_btree.c \
		xfs_dir.c \
		xfs_dir_leaf.c \
		xfs_error.c \
		xfs_extfree_item.c \
		xfs_fsops.c \
		xfs_handle.c \
		xfs_ialloc.c \
		xfs_ialloc_btree.c \
		xfs_icrash.c \
		xfs_iget.c \
		xfs_inode.c \
		xfs_inode_item.c \
		xfs_itable.c \
		xfs_log.c \
		xfs_log_recover.c \
		xfs_macros.c \
		xfs_mount.c \
		xfs_rw.c \
		xfs_trans.c \
		xfs_trans_ail.c \
		xfs_trans_buf.c \
		xfs_trans_extfree.c \
		xfs_trans_inode.c \
		xfs_trans_item.c \
		xfs_vfsops.c \
		xfs_vnodeops.c


XFS_OBJS=$(XFS_CSRCS:.c=.o)
$(XFS_NAME):$(XFS_NAME)($(XFS_OBJS)) MAKELIB

XFSRT_NAME=xfsrt.a
XFSRT_CSRCS=	xfs_grio.c \
		xfs_rtalloc.c \
		xfs_rtbit.c
XFSRT_OBJS=$(XFSRT_CSRCS:.c=.o)
$(XFSRT_NAME):$(XFSRT_NAME)($(XFSRT_OBJS)) MAKELIB

XFSQUOTA_NAME=xfsquotas.a
XFSQUOTA_CSRCS=	xfs_dquot.c \
		xfs_qm.c \
		xfs_qm_syscalls.c \
		xfs_trans_dquot.c \
		xfs_dquot_item.c 
XFSQUOTA_OBJS=$(XFSQUOTA_CSRCS:.c=.o)
$(XFSQUOTA_NAME):$(XFSQUOTA_NAME)($(XFSQUOTA_OBJS)) MAKELIB

XIDBG_NAME=xfsidbg.o
XIDBG_CSRCS=xfsidbg.c

TARGETS=$(XFS_NAME) $(XFSQUOTA_NAME) $(XFSRT_NAME) $(XIDBG_NAME) 

LINTNAME=xfs
CFILES=$(XFS_CSRCS) $(XFSQUOTA_CSRCS) $(XFSRT_CSRCS) $(XIDBG_CSRCS)
HFILES=	xfs_ag.h \
	xfs_alloc.h \
	xfs_alloc_btree.h \
	xfs_attr.h \
	xfs_attr_leaf.h \
	xfs_attr_sf.h \
	xfs_bit.h \
	xfs_bmap.h \
	xfs_bmap_btree.h \
	xfs_btree.h \
	xfs_buf_item.h \
	xfs_clnt.h \
	xfs_dinode.h \
	xfs_da_btree.h \
	xfs_dir.h \
	xfs_dir_leaf.h \
	xfs_dir_sf.h \
	xfs_error.h \
	xfs_extfree_item.h \
	xfs_fsops.h \
	xfs_handle.h \
	xfs_ialloc.h \
	xfs_ialloc_btree.h \
	xfs_imap.h \
	xfs_inode.h \
	xfs_inode_item.h \
	xfs_inum.h \
	xfs_itable.h \
	xfs_log.h \
	xfs_log_priv.h \
	xfs_log_recover.h \
	xfs_macros.h \
	xfs_mount.h \
	xfs_rtalloc.h \
	xfs_rw.h \
	xfs_sb.h \
	xfs_trans.h \
	xfs_trans_priv.h \
	xfs_types.h \
	xfs_dquot.h \
	xfs_dqblk.h \
	xfs_qm.h \
	xfs_quota.h \
	xfs_quota_priv.h

#
# Rules
#
include ${DEPTH}/kcommonrules

$(KCOMMONPREF)default:$(TARGETS)
	${KLINKINSTALL} ${TARGETS}

$(KCOMMONPREF)install: $(KCOMMONPREF)default
	${KINSTALL} ${XFS_NAME}
	${KINSTALL} ${XFSRT_NAME}
	${KINSTALL} ${XIDBG_NAME}
	${KINSTALL} ${XFSQUOTA_NAME}
	${KDEVINSTALL} ${TARGETS}

headers!
	$(INSTALL) -m 444 -F /usr/include/sys/fs $(HFILES)

xfsidbg.o: xfsidbg.c 
	$(CCF) -c $(JALR) -G 0 $(KPATH)/xfsidbg.c && \
	$(LDF) $(PRODOBJECT) -G 0 -r $(.TARGET:T) -o $$$$.o && \
	mv $$$$.o $(.TARGET:T)

xfs_icrash.o: xfs_icrash.c
	$(CCF) -g -c $(JALR) $(KPATH)/xfs_icrash.c && \
	$(LDF) $(PRODOBJECT) -r $(.TARGET:T) -o $$$$.o && \
	mv $$$$.o $(.TARGET:T)
