#
# Makefile for XFS on Linux.
#
# Note! Dependencies are done automagically by 'make dep', which also
# removes any old dependencies. DON'T put your own dependencies here
# unless it's something special (ie not a .c file).
#

#CFLAGS := $(filter-out -Wall,$(CFLAGS))

# EXTRA_MKDEP_OPTIONS = -v

EXTRA_FIND_DIRECTORIES = linux pseudo-inc
EXTRA_INCLUDE_DIRECTORIES = -I./linux -I./pseudo-inc -I.

EXTRA_CFLAGS += -g3 -Wno-unused  -Wno-unknown-pragmas -Wno-parentheses \
                -Wno-uninitialized ${EXTRA_INCLUDE_DIRECTORIES} -D_KERNEL \
		-funsigned-char 

# EXTRA_CFLAGS += -DDEBUG -DXFSDEBUG

ALL_SUB_DIRS = linux
SUB_DIRS = ${ALL_SUB_DIRS}


O_TARGET := xfs.o

xfs.o:	links sub_dirs

ifeq ($(CONFIG_XFS_FS),m)
  M_OBJS   := $(O_TARGET)
  ifeq ($(CONFIG_KDB),y)
    M_OBJS += xfsidbg.o
  endif
else
ifeq ($(CONFIG_KDB),y)
  M_OBJS := xfsidbg.o
endif
endif


XFS_OBJS  :=   xfs_alloc.o \
                xfs_alloc_btree.o \
                xfs_attr.o \
                xfs_attr_leaf.o \
                xfs_bit.o \
                xfs_bmap.o \
                xfs_bmap_btree.o \
                xfs_btree.o \
                xfs_buf_item.o \
                xfs_da_btree.o \
                xfs_dir.o \
                xfs_dir2.o \
                xfs_dir2_block.o \
                xfs_dir2_data.o \
                xfs_dir2_leaf.o \
                xfs_dir2_node.o \
                xfs_dir2_sf.o \
                xfs_dir2_trace.o \
                xfs_dir_leaf.o \
                xfs_error.o \
                xfs_extfree_item.o \
                xfs_fsops.o \
                xfs_ialloc.o \
                xfs_ialloc_btree.o \
                xfs_icrash.o \
                xfs_iget.o \
                xfs_inode.o \
                xfs_inode_item.o \
                xfs_iocore.o \
                xfs_itable.o \
                xfs_dfrag.o \
                xfs_log.o \
                xfs_log_recover.o \
                xfs_macros.o \
                xfs_mount.o \
                xfs_rename.o \
                xfs_trans.o \
                xfs_trans_ail.o \
                xfs_trans_buf.o \
                xfs_trans_extfree.o \
                xfs_trans_inode.o \
                xfs_trans_item.o \
                xfs_utils.o \
                xfs_vfsops.o \
                xfs_vnodeops.o \
                xfs_rw.o \
		xfsdmapistubs.o \
		xfsquotasstubs.o \
		xfsrtstubs.o \
		macstubs.o \
		oplockstubs.o


OX_OBJS :=  $(XFS_OBJS) 

O_OBJS += linux/linux_xfs.o


include $(TOPDIR)/Rules.make

links:
